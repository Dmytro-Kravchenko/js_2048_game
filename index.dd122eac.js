class e{constructor(e,t,l,i){let s=document.createElement("div");s.classList.add("field-cell"),e.append(s),this.x=t,this.y=l,this.grid=i}linkTile(e){e.setXY(this.x,this.y),this.linkedTile=e}linkTileForMerge(e){e.setXY(this.x,this.y),this.linkedTileForMerge=e}canAccept(e){return!this.linkedTile||!this.linkedTileForMerge&&this.linkedTile.value===e.value}mergeTiles(){let e=this.linkedTile.value+this.linkedTileForMerge.value;return this.linkedTile.setValue(e),this.linkedTileForMerge.removeFromDOM(),this.linkedTileForMerge=null,this.grid.updateTotalScore(e),this.score+=e}}class t{constructor(e){this.tileElement=document.createElement("div"),this.tileElement.classList.add("field-tile"),this.setValue(Math.random()>.1?2:4),e.append(this.tileElement)}setXY(e,t){this.x=e,this.y=t,this.tileElement.style.setProperty("--x",e),this.tileElement.style.setProperty("--y",t)}setValue(e){let t=this.value;this.value=e,this.tileElement.textContent=e,this.tileElement.classList.remove(`field-tile--${t}`),this.tileElement.classList.add(`field-tile--${e}`)}removeFromDOM(){this.tileElement.remove()}waitForTransitionEnd(e=!1){return new Promise(t=>{this.tileElement.addEventListener(e?"animationend":"transitionend",t,{once:!0})})}}const l=document.querySelector("button"),i=document.getElementById("game-board"),s=new class{constructor(t){this.cells=[],this.totalScore=0;for(let l=0;l<16;l++)this.cells.push(new e(t,l%4,Math.floor(l/4),this));this.cellsByCol=this.groupCellsByColumn(),this.cellsByReversedCol=this.cellsByCol.map(e=>[...e].reverse()),this.cellsByRow=this.groupCellsByRow(),this.cellsByReversedRow=this.cellsByRow.map(e=>[...e].reverse())}getRandomEmptyCell(){let e=this.cells.filter(e=>!e.linkedTile),t=Math.floor(Math.random()*e.length);return e[t]}groupCellsByColumn(){return this.cells.reduce((e,t)=>(e[t.x]=e[t.x]||[],e[t.x][t.y]=t,e),[])}groupCellsByRow(){return this.cells.reduce((e,t)=>(e[t.y]=e[t.y]||[],e[t.y][t.x]=t,e),[])}reset(){document.querySelectorAll(".field-tile").forEach(e=>{e.remove()}),this.cells.forEach(e=>{e.linkedTile=null})}updateTotalScore(e){this.lastMerge=e,this.totalScore+=e}}(i),n=document.querySelector(".message-win"),r=document.querySelector(".message-lose"),o=document.querySelector(".message-start"),a=document.querySelector(".game-score");function c(){document.addEventListener("keydown",d,{once:!0})}async function d(e){switch(e.key){case"ArrowUp":if(!k()){c();return}await u();break;case"ArrowDown":if(!T()){c();return}await h();break;case"ArrowLeft":if(!w()){c();return}await m();break;case"ArrowRight":if(!g()){c();return}await y();break;default:c();return}if(s.cells.forEach(e=>{e.linkedTileForMerge&&e.mergeTiles()}),a.textContent=s.totalScore,2048===s.lastMerge){n.classList.remove("hidden");return}let l=new t(i);if(s.getRandomEmptyCell().linkTile(l),!k()&&!T()&&!w()&&!g()){l.waitForTransitionEnd(!0).then(()=>{r.classList.remove("hidden")});return}c()}async function u(){await f(s.cellsByCol)}async function h(){await f(s.cellsByReversedCol)}async function m(){await f(s.cellsByRow)}async function y(){await f(s.cellsByReversedRow)}function f(e){return Promise.all(e.flatMap(e=>{let t=[];for(let l=0;l<e.length;l++){let i;if(!e[l].linkedTile)continue;let s=e[l];for(let t=l-1;t>=0;t--){let l=e[t];if(!l.canAccept(s.linkedTile))break;i=l}i&&(t.push(s.linkedTile.waitForTransitionEnd()),i.linkedTile?i.linkTileForMerge(s.linkedTile):i.linkTile(s.linkedTile),s.linkedTile=null)}return t}))}function k(){return v(s.cellsByCol)}function T(){return v(s.cellsByReversedCol)}function w(){return v(s.cellsByRow)}function g(){return v(s.cellsByReversedRow)}function v(e){return e.some(e=>e.some((t,l)=>0!==l&&!!t.linkedTile&&e[l-1].canAccept(t.linkedTile)))}function p(){s.reset(),s.totalScore=0,a.textContent=s.totalScore,s.getRandomEmptyCell().linkTile(new t(i)),s.getRandomEmptyCell().linkTile(new t(i)),r.classList.add("hidden"),n.classList.contains("hidden")||n.classList.add("hidden"),c()}l.addEventListener("click",()=>{l.classList.contains("restart")?confirm("Are you sure you want to restart the game? All progress will be lost.")&&p():(l.classList.remove("start"),l.classList.add("restart"),l.innerHTML="Restart",p(),o.classList.add("hidden"))});
//# sourceMappingURL=index.dd122eac.js.map
